<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Upload Documents â€” JD Communication Services</title>
  <style>
    body { font-family:"Poppins",sans-serif;margin:0;background:#fff7f5; }
    .header{background:linear-gradient(90deg,#ff7b00,#ff2a00);color:white;padding:15px 0;box-shadow:0 2px 8px rgba(0,0,0,0.15);}
    .container{width:90%;max-width:900px;margin:0 auto;}
    .brand{display:flex;align-items:center;gap:12px;}
    .logo-box{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#ff7b00,#ff2a00);
      display:flex;align-items:center;justify-content:center;color:white;font-size:24px;font-weight:700;}
    nav a{color:white;text-decoration:none;margin-left:20px;font-weight:600;}
    nav a.active{text-decoration:underline;}
    main{background:#fff;margin-top:30px;border-radius:12px;padding:25px;box-shadow:0 3px 10px rgba(0,0,0,0.08);}
    label{display:block;margin-top:10px;font-weight:600;}
    input,select,button{width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid #ccc;font-size:14px;}
    button{margin-top:20px;background:linear-gradient(90deg,#ff7b00,#ff2a00);color:white;font-weight:600;border:none;cursor:pointer;}
    button:hover{opacity:0.9;}
    #successMessage{display:none;color:#065f46;background:#ecfdf5;border:1px solid #a7f3d0;padding:12px;margin-top:14px;border-radius:8px;font-weight:600;}
  </style>
</head>
<body>
  <header class="header">
    <div class="container" style="display:flex;align-items:center;justify-content:space-between;">
      <div class="brand">
        <div class="logo-box">JD</div>
        <div>
          <h1 style="font-size:20px;margin:0;">JD Communication Services</h1>
          <small>Document Upload Portal</small>
        </div>
      </div>
      <nav>
        <a href="index.html">Home</a>
        <a href="upload.html" class="active">Upload Documents</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <h2 style="margin-top:0;color:#ff2a00;">Upload Your Documents</h2>
    <p style="color:#555;">Select your service below â€” required documents will appear automatically. You can skip any upload (optional).</p>

    <form id="uploadForm">
      <label for="name">Full Name</label>
      <input type="text" id="name" required placeholder="Enter your full name">

      <label for="phone">Phone Number</label>
      <input type="tel" id="phone" required placeholder="Enter your mobile number">

      <label for="service">Select Service</label>
      <select id="service" required>
        <option value="">-- Select a Service --</option>
        <option value="Community Certificate">Community Certificate</option>
        <option value="Income Certificate">Income Certificate</option>
        <option value="Nativity Certificate">Nativity Certificate</option>
        <option value="PSTM Certificate">PSTM Certificate</option>
        <option value="OBC Certificate">OBC Certificate</option>
        <option value="Voter ID">Voter ID</option>
        <option value="PAN Card">PAN Card</option>
      </select>

      <div id="requirements"></div>
      <button type="submit">Upload Documents</button>
    </form>

    <p id="successMessage">âœ… Documents uploaded successfully! Notification sent to JD Communication Services.</p>
  </main>

  <!-- Supabase + EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>
    // ðŸ”¹ Supabase Setup
    const SUPABASE_URL = "https://olynoxuoeyywhxehrixy.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9seW5veHVvZXl5d2h4ZWhyaXh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5MTAwNjgsImV4cCI6MjA3ODQ4NjA2OH0.TCUTTC-p9dAL4KPLE6MkQ6sLxn-oRa6-5KgjIEhLmkM";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // ðŸ”¹ EmailJS Setup
    emailjs.init("Wlh7hrOINO2-a7k_K"); // your EmailJS public key

    // Required Documents
    const SERVICE_REQUIREMENTS = {
      "Community Certificate": ["Passport Size Photo", "Aadhaar Card", "Ration Card", "Parents/Siblings Community Certificate", "Signature"],
      "Income Certificate": ["Passport Size Photo", "Aadhaar Card", "Ration Card", "Signature"],
      "Nativity Certificate": ["Passport Size Photo", "Aadhaar Card", "Ration Card", "Birth Certificate", "Signature"],
      "PSTM Certificate": ["Basic Details Document", "School TC"],
      "OBC Certificate": ["Passport Size Photo", "Aadhaar Card", "Ration Card", "Income Certificate", "Community Certificate", "Signature"],
      "Voter ID": ["Passport Size Photo", "10th Marksheet", "Aadhaar Card", "Parent Voter ID"],
      "PAN Card": ["Passport Size Photo", "Aadhaar Card", "Signature"]
    };

    const serviceSelect = document.getElementById("service");
    const requirementsDiv = document.getElementById("requirements");
    const successMsg = document.getElementById("successMessage");

    // ðŸ”¸ Dynamically show upload inputs
    serviceSelect.addEventListener("change", () => {
      requirementsDiv.innerHTML = "";
      const selected = serviceSelect.value;
      if (!selected) return;
      SERVICE_REQUIREMENTS[selected].forEach((doc, i) => {
        const label = document.createElement("label");
        label.textContent = `${doc} (optional):`;
        const input = document.createElement("input");
        input.type = "file";
        input.name = `file_${i}`;
        input.accept = ".jpg,.jpeg,.png,.pdf";
        requirementsDiv.appendChild(label);
        requirementsDiv.appendChild(input);
      });
    });

    // ðŸ”¸ Handle Upload + Email
    document.getElementById("uploadForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const service = serviceSelect.value.trim();
      const fileInputs = requirementsDiv.querySelectorAll("input[type=file]");
      const uploadedFiles = [];

      for (const input of fileInputs) {
        if (input.files.length > 0) {
          const file = input.files[0];
          const path = `${service}/${Date.now()}_${file.name}`;
          const { error } = await supabase.storage.from("documents").upload(path, file);
          if (error) { alert("Error uploading " + file.name); return; }
          const { data } = supabase.storage.from("documents").getPublicUrl(path);
          uploadedFiles.push(data.publicUrl);
        }
      }

      // Save record to Supabase table
      await supabase.from("uploads").insert([{ name, phone, service, file_url: uploadedFiles.join(", ") }]);

      // Send Email Notification
      await emailjs.send("service_7fwtzfa", "template_bne8zmp", {
        from_name: name,
        phone: phone,
        service: service,
        file_links: uploadedFiles.length ? uploadedFiles.join("\n") : "No files uploaded"
      });

      successMsg.style.display = "block";
      e.target.reset();
      requirementsDiv.innerHTML = "";
      setTimeout(() => successMsg.style.display = "none", 7000);
    });
  </script>
</body>
</html>
